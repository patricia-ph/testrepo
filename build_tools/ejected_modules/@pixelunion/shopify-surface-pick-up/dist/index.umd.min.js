!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ShopifySurfacePickUp=t()}(this,function(){"use strict";function c(e,t,n,r,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,i)}function e(u){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=u.apply(e,a);function i(e){c(r,t,n,i,o,"next",e)}function o(e){c(r,t,n,i,o,"throw",e)}i(void 0)})}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function o(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?t(Object(i),!0).forEach(function(e){var t,n;t=r,e=i[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}var a="pxu-shopify-surface-pick-up",u="surface-pick-up--loading",s=function(e){return e+36e5>=Date.now()},l=function(e){return e.replace(/(.*)\/$/,"$1")};function f(){return(f=e(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(t,e){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){e=e.coords;return t(e)},e,{maximumAge:36e5,timeout:5e3}):e()}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function p(){return(p=e(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.latitude,r=t.longitude,i={latitude:n,longitude:r,timestamp:Date.now()},localStorage.setItem(a,JSON.stringify(i)),e.abrupt("return",fetch("/localization.json",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:n,longitude:r})}).then(function(){return{latitude:n,longitude:r}}));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function d(){return(d=e(regeneratorRuntime.mark(function e(){var t,n,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<r.length&&void 0!==r[0]&&r[0],(n=JSON.parse(localStorage.getItem(a)))&&s(n.timestamp))return e.abrupt("return",n);e.next=4;break;case 4:if(t)return e.abrupt("return",function(){return f.apply(this,arguments)}().then(function(e){return function(){p.apply(this,arguments)}(e),e}));e.next=6;break;case 6:return e.abrupt("return",null);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}return function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.el=e,this.options=o({root_url:window.Theme&&window.Theme.routes&&window.Theme.routes.root_url||""},t),this.options.root_url=l(this.options.root_url),this.callbacks=[],this.onBtnPress=null,this.latestVariantId=null}var e,t,r;return e=n,(t=[{key:"load",value:function(e){var t=this;return e?(this.latestVariantId=e,this.el.classList.add(u),this._getData(e).then(function(e){return t._injectData(e)})):(this.el.innerHTML="",Promise.resolve(!0))}},{key:"onModalRequest",value:function(e){0<=this.callbacks.indexOf(e)||this.callbacks.push(e)}},{key:"offModalRequest",value:function(e){this.callbacks.splice(this.callbacks.indexOf(e))}},{key:"unload",value:function(){this.callbacks=[],this.el.innerHTML=""}},{key:"_getData",value:function(o){var t=this;return new Promise(function(r){var i=new XMLHttpRequest,e="".concat(t.options.root_url,"/variants/").concat(o,"/?section_id=surface-pick-up");i.open("GET",e,!0),i.onload=function(){var e=i.response,t=e.querySelector('[data-html="surface-pick-up-embed"]'),n=e.querySelector('[data-html="surface-pick-up-items"]'),e=n.content.querySelectorAll("[data-surface-pick-up-item]");r({embed:t,itemsContainer:n,items:e,variantId:o})},i.onerror=function(){r({embed:{innerHTML:""},itemsContainer:{innerHTML:""},items:[],variantId:o})},i.responseType="document",i.send()})}},{key:"_injectData",value:function(e){var t=this,n=e.embed,r=e.itemsContainer,i=e.items;if(e.variantId!==this.latestVariantId||0===i.length)return this.el.innerHTML="",void this.el.classList.remove(u);this.el.innerHTML=n.innerHTML,this.el.classList.remove(u);function o(){return a?Promise.resolve():function(){return d.apply(this,arguments)}(!0).then(function(c){i.forEach(function(e){var t,n,r=e.querySelector("[data-distance]"),i=e.querySelector("[data-distance-unit]"),o=i.dataset.distanceUnit,a=parseFloat(r.dataset.latitude),u=parseFloat(r.dataset.longitude);c&&isFinite(a)&&isFinite(u)?(t=c.latitude,n=c.longitude,e=a,a=u,u=o,o=Math.PI/180,u="metric"===u?6378.14:3959,t*=o,e*=o,o=n*o-a*o,o=Math.pow(Math.sin((t-e)/2),2)+Math.cos(t)*Math.cos(e)*Math.pow(Math.sin(o/2),2),o=u*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))),r.innerHTML=o.toFixed(1)):(r.remove(),i.remove())})}).catch(function(e){console.log(e),i.forEach(function(e){var t=e.querySelector("[data-distance]"),e=e.querySelector("[data-distance-unit]");t.remove(),e.remove()})}).finally(function(){a=!0})}var a=!1;this.el.querySelector("[data-surface-pick-up-embed-modal-btn]").addEventListener("click",function(){o().then(function(){return t.callbacks.forEach(function(e){return e(r.innerHTML)})})})}}])&&i(e.prototype,t),r&&i(e,r),n}()});